#####################################################################
# 	Hardware
#####################################################################

[include steppers.cfg]
#[include calibrate_z.cfg]
[include kiauh_macros.cfg]
[include probing.cfg]
[include heaters_fans.cfg]
[include input_shaper.cfg]
[include Tool_Head.cfg]
[include Fan_Monitor.cfg]

#####################################################################
# 	Macros
#####################################################################

#[include klicky_probe.cfg]
[include bedfans_dualcontrol.cfg]
[include nozzle_scrub.cfg]
[include stealthburner_leds.cfg]
[include macros.cfg]
[include bed_mesh.cfg]
[include pause_resume.cfg]
[include print_macros.cfg]
[include KAMP_Settings.cfg]
[include Adaptive_Meshing.cfg]
[include Line_Purge.cfg]
[include K-ShakeTune/*.cfg]
[include config_backup.cfg]

#####################################################################
# 	Kinematics
#####################################################################

[printer]
kinematics: corexy
max_velocity: 1000
max_accel: 6000		#Max 4000
max_accel_to_decel: 3000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_D50F920C4E4B333448202020FF0A0E24-if00
x_offset: 0 # update with offset from nozzle on your machine
y_offset: 21.953 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
z_settling_time: 1000

#############################################
# Enable to SET_KINEMATIC_POSITION for Z hop
[force_move]
enable_force_move: True

#################
# Homing Override
[homing_override]
axes: xyz
gcode:
  {% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}
  {% if home_all or 'X' in params or 'Y' in params %} #Always Home X&Y together
    _HOME_XY
  {% endif %}
  {% if home_all or 'Z' in params %}
    _HOME_Z
  {% endif %}

[gcode_macro _HOME_XY]

[gcode_macro _HOME_XY]
gcode:
    {% if not 'Z' in printer.toolhead.homed_axes %}
      # Set Z to 0 if not homed
      SET_KINEMATIC_POSITION Z=0
    {% endif %}

    # Z hop before homing
    G1 Z10 F600
    G28 Y
    G0 Y175 F10000
    G28 X

[gcode_macro _HOME_Z]
gcode:
    # Check if X&Y are homed
    {% if not 'xy' in printer.toolhead.homed_axes %} 
      { action_respond_info("X & Y not Homed, Forcing Full G28") }
      SET_KINEMATIC_POSITION Z=0
      G1 Z10 F600
      G28 Y
      G0 Y175 F10000
      G28 X
    {% endif %}
    G0 Y175 F10000
    G0 X175 F10000
    G28 Z
    G1 Z10


  
#[safe_z_home]
#home_xy_position: 175, 175 # update for your machine
#z_hop: 3

[respond]

[idle_timeout]
timeout: 14400

[virtual_sdcard]
path: ~/gcode_files

[display_status]

[pause_resume]

[exclude_object]

#[filament_switch_sensor filament_sensor]
#switch_pin: ^PG12
#pause_on_runout: True
#insert_gcode:
#    M117 Insert Detected
#runout_gcode:
#    M117 Runout Detected

[filament_motion_sensor filament_sensor]
detection_length: 10
extruder: extruder
switch_pin: ^PG12
pause_on_runout: True
insert_gcode:
    M117 Insert Detected
    status_printing
runout_gcode:
    M117 Runout Detected
    status_error  # Turn LEDs red

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration: 1
gcode:
    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0


#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin caselight]
pin: PA2
pwm:true
shutdown_value: 0
value:1
cycle_time: 0.001

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 38.838
#*# pid_ki = 1.221
#*# pid_kd = 308.765
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 23.623
#*# pid_ki = 2.316
#*# pid_kd = 60.238
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.036179, 0.050289, 0.057680, 0.065990, 0.074162, 0.082199, 0.086824, 0.092021, 0.097091, 0.099669, 0.098416, 0.107072, 0.106737, 0.107692, 0.106388, 0.104872, 0.103397, 0.095249, 0.097416, 0.093771, 0.090256, 0.087172, 0.082410, 0.079019, 0.069690, 0.069187, 0.061730, 0.053927, 0.046914, 0.041061, 0.035866, 0.034346
#*# 	  0.041396, 0.050425, 0.057088, 0.066285, 0.075045, 0.078873, 0.087100, 0.091933, 0.096583, 0.099773, 0.104709, 0.107067, 0.102145, 0.107865, 0.105189, 0.103754, 0.102543, 0.099611, 0.097052, 0.088394, 0.091423, 0.087595, 0.084708, 0.079903, 0.074190, 0.069525, 0.054945, 0.055948, 0.049109, 0.039812, 0.035660, 0.027114
#*# 	  0.038692, 0.047729, 0.052486, 0.063849, 0.073660, 0.079656, 0.086498, 0.090666, 0.094201, 0.099304, 0.103517, 0.104757, 0.106283, 0.105542, 0.102988, 0.101067, 0.101123, 0.096790, 0.096018, 0.092233, 0.090070, 0.086141, 0.082701, 0.077067, 0.072895, 0.067003, 0.060134, 0.054358, 0.047662, 0.039581, 0.035413, 0.029217
#*# 	  0.037688, 0.045108, 0.054122, 0.062639, 0.070113, 0.076626, 0.083995, 0.087627, 0.092442, 0.097361, 0.101116, 0.103715, 0.105073, 0.104247, 0.102449, 0.099024, 0.096872, 0.095817, 0.092403, 0.090159, 0.087462, 0.082482, 0.079812, 0.074753, 0.070050, 0.065403, 0.059229, 0.052884, 0.046807, 0.039098, 0.032516, 0.024861
#*# 	  0.033035, 0.040318, 0.049442, 0.057073, 0.065232, 0.071542, 0.078693, 0.083455, 0.089115, 0.094141, 0.098560, 0.099752, 0.102295, 0.100681, 0.099052, 0.096724, 0.094393, 0.090463, 0.088004, 0.085570, 0.082441, 0.078972, 0.075086, 0.070715, 0.065447, 0.061237, 0.053473, 0.049027, 0.043430, 0.036623, 0.029114, 0.022857
#*# 	  0.028747, 0.036101, 0.045579, 0.051422, 0.058643, 0.065875, 0.071159, 0.076149, 0.083528, 0.087912, 0.092573, 0.094218, 0.096427, 0.097043, 0.094142, 0.092294, 0.089462, 0.085768, 0.083551, 0.081095, 0.077514, 0.074220, 0.070867, 0.064756, 0.061274, 0.055982, 0.047240, 0.042871, 0.037695, 0.031086, 0.024207, 0.017142
#*# 	  0.023029, 0.029926, 0.037899, 0.045442, 0.054272, 0.060512, 0.066266, 0.069456, 0.077491, 0.081471, 0.085725, 0.088237, 0.088984, 0.089587, 0.088533, 0.085560, 0.084192, 0.079958, 0.078906, 0.074219, 0.072571, 0.066802, 0.064757, 0.059021, 0.054084, 0.048294, 0.040475, 0.035659, 0.028949, 0.024508, 0.018957, 0.012903
#*# 	  0.018340, 0.025976, 0.032582, 0.042641, 0.047563, 0.054672, 0.060496, 0.066410, 0.070624, 0.076181, 0.084496, 0.081250, 0.082760, 0.083405, 0.081925, 0.079343, 0.077533, 0.075124, 0.072904, 0.068238, 0.063463, 0.060484, 0.056445, 0.052781, 0.048067, 0.043353, 0.034711, 0.028908, 0.024612, 0.018122, 0.013360, 0.006778
#*# 	  0.015576, 0.023407, 0.030604, 0.038428, 0.046472, 0.051857, 0.057434, 0.061819, 0.066621, 0.070429, 0.074590, 0.077077, 0.076761, 0.077428, 0.075948, 0.075039, 0.075329, 0.071168, 0.068214, 0.064495, 0.059445, 0.054760, 0.051896, 0.048895, 0.044101, 0.038215, 0.031079, 0.026139, 0.018585, 0.014836, 0.009008, 0.003658
#*# 	  0.011675, 0.019353, 0.026530, 0.036292, 0.043773, 0.049829, 0.056423, 0.058344, 0.062396, 0.066471, 0.068093, 0.071127, 0.072224, 0.075265, 0.070472, 0.070131, 0.067931, 0.065991, 0.062637, 0.058621, 0.053623, 0.049873, 0.046411, 0.043513, 0.039482, 0.035416, 0.027246, 0.022848, 0.017362, 0.011884, 0.006386, 0.000502
#*# 	  0.010876, 0.019294, 0.026320, 0.034568, 0.042284, 0.048628, 0.056199, 0.055324, 0.059468, 0.063381, 0.066859, 0.066705, 0.067864, 0.069567, 0.066815, 0.064874, 0.065224, 0.061854, 0.059480, 0.054686, 0.053411, 0.045912, 0.043280, 0.039500, 0.037241, 0.031236, 0.025515, 0.022609, 0.014569, 0.009495, 0.003987, -0.001108
#*# 	  0.007170, 0.015902, 0.022180, 0.029434, 0.038344, 0.045795, 0.048817, 0.052343, 0.055059, 0.061841, 0.061954, 0.061529, 0.062071, 0.062244, 0.061758, 0.059846, 0.064571, 0.055920, 0.051841, 0.048735, 0.044050, 0.042240, 0.038789, 0.041884, 0.032392, 0.028244, 0.021238, 0.016682, 0.012862, 0.006944, 0.001620, -0.003651
#*# 	  0.004115, 0.011972, 0.018031, 0.030704, 0.033771, 0.040775, 0.044104, 0.048383, 0.051142, 0.054043, 0.058816, 0.057185, 0.056512, 0.056569, 0.054999, 0.054839, 0.052365, 0.051532, 0.046735, 0.042675, 0.039196, 0.036526, 0.033309, 0.031103, 0.028443, 0.022792, 0.017864, 0.012509, 0.007335, 0.002884, -0.002801, -0.008714
#*# 	  -0.001133, 0.007647, 0.013002, 0.021505, 0.028816, 0.036466, 0.039032, 0.042384, 0.045672, 0.048462, 0.051634, 0.051682, 0.054620, 0.051246, 0.048708, 0.047962, 0.045936, 0.045016, 0.040607, 0.040379, 0.032668, 0.029360, 0.027244, 0.024415, 0.022739, 0.018166, 0.017138, 0.007580, 0.004181, -0.002330, -0.009135, -0.012985
#*# 	  -0.008647, -0.001427, 0.005793, 0.013406, 0.020483, 0.026557, 0.030221, 0.036533, 0.037398, 0.041220, 0.043048, 0.043770, 0.043583, 0.042027, 0.040405, 0.038622, 0.037972, 0.034235, 0.031917, 0.028982, 0.023665, 0.020852, 0.016650, 0.015081, 0.013758, 0.010579, 0.005307, 0.001768, -0.005395, -0.010508, -0.015349, -0.020816
#*# 	  -0.015846, -0.008456, -0.001399, 0.005872, 0.012613, 0.017881, 0.022394, 0.024654, 0.028694, 0.033054, 0.036133, 0.038177, 0.036683, 0.036012, 0.032797, 0.032042, 0.029575, 0.028461, 0.024130, 0.020701, 0.016106, 0.010602, 0.011595, 0.005844, 0.004136, 0.001355, -0.004241, -0.009295, -0.013076, -0.019488, -0.025555, -0.030629
#*# 	  -0.024437, -0.016400, -0.007056, -0.002233, 0.007048, 0.008802, 0.013851, 0.015991, 0.020039, 0.024346, 0.027513, 0.030390, 0.029458, 0.027522, 0.025698, 0.024401, 0.021481, 0.019855, 0.016547, 0.012272, 0.008574, 0.003322, -0.000527, -0.004875, -0.006768, -0.009901, -0.014295, -0.018831, -0.025190, -0.030936, -0.035902, -0.040504
#*# 	  -0.033116, -0.025415, -0.017513, -0.010939, -0.003539, 0.000622, 0.004919, 0.007668, 0.011654, 0.016388, 0.020815, 0.021772, 0.023111, 0.020526, 0.019916, 0.017081, 0.016303, 0.012602, 0.013743, 0.006616, 0.000462, -0.004244, -0.008871, -0.013546, -0.015676, -0.020124, -0.024772, -0.029205, -0.034133, -0.039118, -0.045789, -0.053207
#*# 	  -0.036986, -0.030215, -0.020863, -0.014272, -0.008160, -0.002187, 0.000854, 0.004558, 0.007536, 0.012088, 0.016025, 0.016965, 0.017876, 0.016358, 0.015931, 0.013845, 0.012312, 0.009803, 0.006754, 0.002394, -0.002948, -0.009109, -0.013128, -0.018189, -0.022490, -0.026415, -0.031189, -0.036038, -0.040977, -0.046905, -0.051946, -0.057943
#*# 	  -0.040491, -0.030445, -0.023164, -0.015711, -0.008914, -0.004185, -0.000495, 0.002760, 0.005884, 0.009592, 0.013431, 0.014115, 0.015396, 0.014503, 0.013782, 0.011829, 0.010244, 0.007719, 0.005874, -0.000555, -0.005301, -0.011677, -0.016588, -0.022572, -0.026680, -0.031298, -0.036603, -0.040817, -0.045730, -0.051465, -0.056242, -0.063870
#*# 	  -0.039387, -0.030311, -0.022543, -0.015173, -0.007765, -0.003239, 0.001007, 0.003995, 0.007075, 0.009417, 0.012517, 0.014783, 0.013090, 0.013768, 0.012135, 0.011563, 0.009983, 0.007377, 0.003963, -0.000860, -0.007865, -0.012715, -0.018864, -0.024709, -0.031048, -0.035178, -0.040240, -0.045382, -0.048843, -0.054992, -0.059951, -0.064999
#*# 	  -0.039501, -0.031060, -0.023213, -0.014421, -0.007621, -0.001999, 0.002056, 0.004852, 0.006702, 0.010638, 0.014276, 0.014524, 0.014620, 0.012491, 0.012398, 0.007650, 0.009229, 0.006820, 0.002521, -0.002837, -0.007706, -0.016789, -0.021987, -0.027610, -0.033686, -0.037153, -0.043194, -0.046653, -0.051669, -0.056470, -0.061132, -0.068965
#*# 	  -0.036578, -0.028811, -0.020373, -0.012135, -0.007200, -0.000084, 0.005012, 0.007150, 0.010488, 0.012991, 0.015370, 0.014628, 0.015720, 0.013716, 0.012190, 0.010998, 0.010034, 0.007748, 0.003561, -0.001761, -0.009595, -0.016205, -0.022620, -0.028106, -0.033014, -0.038360, -0.043376, -0.047570, -0.052593, -0.058380, -0.063311, -0.069915
#*# 	  -0.037725, -0.027652, -0.020634, -0.012440, -0.004986, -0.000107, 0.004483, 0.007816, 0.011697, 0.013366, 0.016597, 0.014012, 0.015446, 0.014666, 0.013034, 0.010360, 0.010142, 0.007640, 0.000643, -0.003149, -0.010252, -0.018400, -0.022844, -0.029644, -0.033852, -0.039903, -0.044729, -0.047872, -0.053510, -0.060203, -0.065242, -0.072786
#*# 	  -0.036477, -0.028725, -0.020698, -0.012140, -0.006329, -0.000063, 0.004617, 0.008010, 0.011302, 0.013664, 0.016131, 0.016448, 0.015627, 0.013886, 0.014146, 0.010857, 0.009979, 0.006558, 0.002293, -0.003345, -0.009778, -0.016153, -0.021808, -0.027316, -0.032369, -0.037389, -0.043517, -0.048250, -0.053000, -0.059334, -0.066119, -0.073695
#*# 	  -0.037260, -0.026762, -0.020216, -0.012736, -0.005259, -0.000908, 0.005126, 0.007123, 0.012377, 0.015150, 0.017385, 0.016510, 0.017869, 0.015615, 0.015015, 0.012451, 0.011290, 0.007701, 0.002949, -0.002376, -0.009142, -0.015425, -0.019635, -0.025708, -0.030219, -0.036070, -0.041891, -0.047039, -0.053400, -0.060027, -0.066632, -0.073343
#*# 	  -0.035686, -0.027031, -0.020134, -0.012811, -0.005421, -0.001112, 0.004105, 0.008297, 0.011467, 0.014403, 0.016241, 0.017052, 0.016363, 0.016691, 0.014661, 0.013846, 0.011595, 0.007991, 0.003572, -0.001847, -0.008528, -0.013083, -0.018373, -0.022574, -0.028070, -0.034031, -0.041039, -0.044850, -0.050495, -0.057840, -0.064493, -0.073391
#*# 	  -0.032408, -0.022270, -0.016023, -0.007991, -0.001025, 0.002872, 0.007820, 0.010873, 0.015054, 0.017717, 0.020770, 0.020576, 0.021347, 0.020773, 0.019831, 0.018548, 0.015630, 0.012037, 0.006641, 0.000529, -0.005107, -0.009980, -0.014603, -0.019947, -0.024201, -0.030727, -0.036545, -0.042211, -0.047368, -0.056721, -0.061916, -0.069209
#*# 	  -0.025802, -0.016799, -0.008587, -0.000199, 0.005775, 0.011002, 0.015465, 0.018812, 0.022290, 0.025044, 0.027456, 0.027203, 0.026605, 0.027612, 0.026386, 0.025084, 0.022416, 0.017505, 0.013741, 0.007931, 0.002177, -0.003615, -0.008118, -0.011482, -0.015650, -0.022056, -0.029428, -0.035184, -0.041566, -0.048402, -0.054448, -0.061809
#*# 	  -0.015684, -0.005876, 0.002844, 0.010398, 0.018498, 0.022886, 0.028395, 0.031400, 0.033818, 0.036567, 0.038927, 0.038363, 0.038317, 0.038052, 0.037868, 0.036713, 0.034057, 0.031024, 0.025293, 0.018719, 0.013550, 0.009422, 0.004187, -0.000089, -0.004768, -0.010250, -0.017796, -0.023717, -0.029575, -0.037613, -0.044194, -0.051070
#*# tension = 0.2
#*# min_x = 89.3239
#*# algo = bicubic
#*# y_count = 30
#*# mesh_y_pps = 2
#*# min_y = 95.6283
#*# x_count = 32
#*# max_y = 258.191
#*# mesh_x_pps = 2
#*# max_x = 256.5
#*#
#*# [beacon model default]
#*# model_coef = 1.4932847207145445,
#*# 	  1.813087807762665,
#*# 	  0.7366414453603123,
#*# 	  0.3563491168806203,
#*# 	  0.3852608157240816,
#*# 	  0.34424757540113665,
#*# 	  -0.26878256853592825,
#*# 	  -0.3108931011339748,
#*# 	  0.25378617562176914,
#*# 	  0.19890986381416514
#*# model_domain = 3.2251538094536715e-07,3.3508521240797756e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.134019
#*# model_offset = -1.05000
