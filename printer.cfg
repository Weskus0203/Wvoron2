#####################################################################
# 	Hardware
#####################################################################

[include steppers.cfg]
#[include calibrate_z.cfg]
[include kiauh_macros.cfg]
[include heaters_fans.cfg]
[include input_shaper.cfg]
[include tool_Head.cfg]
[include Fan_Monitor.cfg]

#####################################################################
# 	Macros and configs
#####################################################################

[include bedfans_dualcontrol.cfg]
#[include nozzle_scrub.cfg]
[include stealthburner_leds.cfg]
[include macros.cfg]
[include bed_mesh.cfg]
[include Line_Purge.cfg]
[include config_backup.cfg]

#####################################################################
# 	Kinematics
#####################################################################

[printer]
kinematics: corexy
max_velocity: 1500
max_accel: 15000		#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 20.0

[skew_correction]

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_D50F920C4E4B333448202020FF0A0E24-if00
x_offset: 0 # update with offset from nozzle on your machine
y_offset: 21.953 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
z_settling_time: 1000
speed: 5
lift_speed: 5
home_y_before_x: True
home_xy_position: 155, 170
home_z_hop: 10
home_z_hop_speed: 30
home_xy_move_speed: 300
home_method: contact  
home_method_when_homed: proximity
home_autocalibrate: unhomed #|unhomed|never|always
contact_max_hotend_temperature: 180
default_model_name: default

#############################################
# Enable to SET_KINEMATIC_POSITION for Z hop
[force_move]
enable_force_move: True

# [high_resolution_filament_sensor roadrunner]
# extruder: extruder
# #  The extruder to which this sensor is attached
# #uart_rx_pin: P0.0
# #uart_tx_pin: P0.1
# #  TX and RX pins for UART communication, leave out if i2c or USB serial is used (see below).
# #i2c_address: 64
# #  The address of the sensor on the I2C bus, the default is 64 (0x40). Only
# #  change this if you attach more than one sensor on the same I2C bus.
# #i2c_mcu: EBBCan
# #  The mcu on which the sensor is connected.
# #i2c_bus: i2c3_PB3_PB4
# #  The I2C bus to which the sensor is connected on the mcu.
# serial: /dev/serial/by-id/usb-Raspberry_Pi_Pico_454741505C0875AA-if00
# #  The serial port over which the sensor is connected. Find with `ls -alh /dev/serial/by-id`.
# pause_on_runout: False
# #  Whether or not to pause the print automatically when a runout
# #  condition is triggered.
# runout_gcode: 
#     RESPOND TYPE=command MSG='Filament runout detected'
#     PAUSE
#     status_error
# #  The gcode to execute when a runout condition is detected.
# invert_direction: False
# # If the measured distance/speed values are negative, change this to True.
# rotation_distance: 23.3732877
# # The length of filament which corresponds to a full 360 degree rotation
# # of the magnet over the rotary encoder. A good starting point is the
# # circumference of the BMG gears in the sensor.
# underextrusion_max_rate: 0.5
# # What rate of underextrusion can be tolerated, as a value between 0.0 and 1.0.
# # The rate is calculated by comparing the extruder position to the measured
# # filament length over a certain period. A rate of 0.0 means the measured
# # filament motion matches the expected extrusion distance over the period.
# # A rate of 1.0 means no filament motion was detected at all when some motion
# # was expected for the extruder.
# underextrusion_period: 5
# # How long should the underextrusion rate stay above the max rate before
# # a runout is triggered.
# hysteresis_bits: 3
# # How many bits to ignore from the magnetic rotary encoder's angle data.
# # This setting determines the minimum detectable change in position
# # for the sensor. Configuring this too low can result in flapping between
# # two adjacent positions even when the filament is not moving.

# [filament_motion_sensor roadrunner_motion]
# detection_length: 2
# extruder: extruder
# switch_pin: virtual_motion_sensor:roadrunner
# pause_on_runout: False
# runout_gcode: 
#     RESPOND TYPE=command MSG='Filament motion sensor detected a runout'
#     PAUSE
#     status_error  # Turn LEDs red
# event_delay: 0.1

# [filament_switch_sensor roadrunner_switch]
# switch_pin: virtual_switch_sensor:roadrunner 
# pause_on_runout: False
# insert_gcode:
#     RESPOND TYPE=command MSG='Filament switch sensor detected filament is now present'
#     status_printing  
# runout_gcode: 
#     RESPOND TYPE=command MSG='Filament switch sensor detected filament is no longer present'
#     PAUSE
#     status_error  # Turn LEDs red
# event_delay: 0.1


#################
# Homing Override
#[homing_override]
#axes: xyz
#gcode:
#  {% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}
#  {% if home_all or 'X' in params or 'Y' in params %} #Always Home X&Y together
#    _HOME_XY
#  {% endif %}
#  {% if home_all or 'Z' in params %}
#    _HOME_Z
#  {% endif %}

#[gcode_macro _HOME_XY]
#gcode:
#    {% if not 'Z' in printer.toolhead.homed_axes %}
      # Set Z to 0 if not homed
#      SET_KINEMATIC_POSITION Z=0
#    {% endif %}

    # Z hop before homing
#    G1 Z10 F600
#    G28 Y
#    G0 Y175 F10000
#    G28 X

#[gcode_macro _HOME_Z]
#gcode:
    # Check if X&Y are homed
#    {% if not 'xy' in printer.toolhead.homed_axes %} 
#      { action_respond_info("X & Y not Homed, Forcing Full G28") }
#      SET_KINEMATIC_POSITION Z=0
#      G1 Z10 F600
#      G28 Y
#      G0 Y175 F10000
#      G28 X
#    {% endif %}
#    G0 Y175 F10000
#    G0 X175 F10000
#    G28 Z
#    G1 Z10

# [safe_z_home]
# home_xy_position: 175, 175
# z_hop: 10

[respond]

[idle_timeout]
timeout: 14400

[virtual_sdcard]
path: /home/pi/printer_data/gcodes

[display_status]

[pause_resume]

[exclude_object]

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin caselight]
pin: PA2
pwm:true
shutdown_value: 0
value:1
cycle_time: 0.001

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 59.127
#*# pid_ki = 2.538
#*# pid_kd = 344.415
#*# pid_version = 1
#*# pid_target = 100.00
#*# pid_tolerance = 0.0200
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.140749, 0.129288, 0.116754, 0.134893, 0.137068, 0.152899, 0.137621, 0.123897, 0.152224, 0.139254, 0.149691, 0.132351, 0.114876, 0.139937, 0.122979, 0.105254, 0.118336, 0.102072, 0.125957, 0.109719, 0.093029, 0.106768, 0.106362, 0.120896, 0.104742, 0.088062, 0.102677, 0.104515, 0.122517, 0.110453, 0.097457, 0.125657
#*# 	0.140577, 0.132407, 0.147808, 0.125361, 0.140595, 0.153512, 0.141222, 0.142449, 0.128887, 0.142064, 0.152824, 0.124434, 0.133559, 0.116858, 0.127421, 0.137767, 0.108534, 0.119930, 0.115218, 0.113681, 0.123578, 0.097446, 0.110407, 0.122990, 0.109356, 0.107375, 0.094265, 0.109432, 0.126473, 0.103815, 0.118578, 0.103530
#*# 	0.120021, 0.145091, 0.137907, 0.129602, 0.142766, 0.143857, 0.154851, 0.143855, 0.132012, 0.155352, 0.143346, 0.150147, 0.136575, 0.122898, 0.142298, 0.128752, 0.113452, 0.123757, 0.108535, 0.128938, 0.115000, 0.101201, 0.113510, 0.113748, 0.125395, 0.111797, 0.100184, 0.126229, 0.117638, 0.131505, 0.122332, 0.110550
#*# 	0.130836, 0.143317, 0.125861, 0.139919, 0.153019, 0.143787, 0.144130, 0.133065, 0.143073, 0.153855, 0.130859, 0.138894, 0.125933, 0.134684, 0.143004, 0.118157, 0.125948, 0.113429, 0.121312, 0.129945, 0.103896, 0.114005, 0.125360, 0.114456, 0.125583, 0.102513, 0.113637, 0.126128, 0.117388, 0.119903, 0.109694, 0.121385
#*# 	0.129075, 0.120812, 0.143828, 0.137202, 0.131275, 0.142170, 0.142221, 0.151135, 0.140977, 0.130300, 0.149680, 0.137542, 0.147056, 0.133410, 0.121241, 0.137542, 0.125513, 0.113422, 0.121000, 0.108347, 0.125082, 0.111642, 0.101267, 0.112063, 0.112178, 0.122477, 0.111712, 0.102424, 0.125604, 0.116162, 0.127545, 0.116265
#*# 	0.133528, 0.118886, 0.129873, 0.140976, 0.135988, 0.146316, 0.129078, 0.137369, 0.147038, 0.136282, 0.136205, 0.124794, 0.133840, 0.140085, 0.119552, 0.125182, 0.114282, 0.120958, 0.128532, 0.105501, 0.111701, 0.119186, 0.108458, 0.118995, 0.098516, 0.108114, 0.116560, 0.108553, 0.110004, 0.100962, 0.112230, 0.121641
#*# 	0.113194, 0.122037, 0.116705, 0.133794, 0.129611, 0.123100, 0.139968, 0.130346, 0.139060, 0.129872, 0.121041, 0.135565, 0.125673, 0.122908, 0.121461, 0.110013, 0.124289, 0.112727, 0.102103, 0.107518, 0.096167, 0.112002, 0.102052, 0.093143, 0.101144, 0.099822, 0.108261, 0.100917, 0.092198, 0.112947, 0.104220, 0.103894
#*# 	0.108010, 0.116728, 0.125253, 0.120778, 0.131804, 0.116581, 0.125124, 0.133901, 0.116923, 0.124501, 0.114508, 0.119947, 0.126327, 0.106316, 0.113084, 0.102550, 0.107698, 0.113440, 0.094796, 0.100142, 0.105581, 0.095849, 0.104304, 0.087164, 0.094444, 0.102064, 0.092233, 0.093554, 0.086342, 0.096772, 0.105187, 0.088248
#*# 	0.111713, 0.106054, 0.115382, 0.109982, 0.127475, 0.121525, 0.114656, 0.129575, 0.121211, 0.128365, 0.119303, 0.108583, 0.120524, 0.109654, 0.107081, 0.105173, 0.093725, 0.108169, 0.098009, 0.087011, 0.091400, 0.080654, 0.099237, 0.090784, 0.082148, 0.096496, 0.087391, 0.097379, 0.089069, 0.082522, 0.100185, 0.092020
#*# 	0.111338, 0.112979, 0.114050, 0.124356, 0.111412, 0.120605, 0.129254, 0.120261, 0.118858, 0.109802, 0.116147, 0.120731, 0.101463, 0.106500, 0.094230, 0.100503, 0.106843, 0.087800, 0.094023, 0.099298, 0.087105, 0.093510, 0.077018, 0.086349, 0.095811, 0.085724, 0.093214, 0.076268, 0.085814, 0.095535, 0.079592, 0.088726
#*# 	0.117232, 0.111643, 0.105998, 0.117210, 0.111685, 0.128298, 0.119631, 0.111368, 0.123922, 0.115458, 0.120824, 0.111258, 0.099985, 0.111585, 0.099541, 0.096749, 0.094081, 0.086090, 0.099233, 0.088202, 0.076964, 0.081897, 0.074281, 0.091578, 0.084298, 0.074966, 0.090646, 0.082802, 0.091249, 0.084512, 0.077158, 0.095121
#*# 	0.108094, 0.110570, 0.118261, 0.110213, 0.117913, 0.124966, 0.118245, 0.123031, 0.107535, 0.112616, 0.116204, 0.099713, 0.103335, 0.094012, 0.097049, 0.100625, 0.083947, 0.090563, 0.087436, 0.085296, 0.087958, 0.072211, 0.078790, 0.085682, 0.080386, 0.086996, 0.072984, 0.080677, 0.087908, 0.075307, 0.083417, 0.077208
#*# 	0.100896, 0.111875, 0.107876, 0.106725, 0.119064, 0.114363, 0.119309, 0.112313, 0.104469, 0.113390, 0.104118, 0.101414, 0.097789, 0.090292, 0.098382, 0.090997, 0.088030, 0.086436, 0.077639, 0.086260, 0.076574, 0.067607, 0.074014, 0.067081, 0.081235, 0.074341, 0.068230, 0.082165, 0.076737, 0.084483, 0.079894, 0.073805
#*# 	0.100627, 0.108001, 0.098094, 0.106566, 0.114067, 0.109374, 0.114838, 0.101770, 0.104583, 0.108327, 0.091541, 0.093332, 0.084512, 0.088859, 0.093385, 0.079902, 0.083487, 0.081343, 0.077180, 0.079185, 0.065163, 0.068031, 0.073136, 0.067488, 0.074264, 0.062261, 0.067462, 0.074429, 0.063896, 0.071717, 0.066633, 0.073700
#*# 	0.093602, 0.090657, 0.100935, 0.098351, 0.095338, 0.105888, 0.095329, 0.102864, 0.094935, 0.088223, 0.092608, 0.083663, 0.080794, 0.078048, 0.071787, 0.080284, 0.072682, 0.070135, 0.066139, 0.057065, 0.064003, 0.056624, 0.052082, 0.064714, 0.053705, 0.064684, 0.058630, 0.052980, 0.066006, 0.062905, 0.063601, 0.063729
#*# 	0.088688, 0.082427, 0.088875, 0.095964, 0.092232, 0.096758, 0.086527, 0.088964, 0.090642, 0.078832, 0.079017, 0.070504, 0.070594, 0.072248, 0.060090, 0.062255, 0.060101, 0.056768, 0.058289, 0.045244, 0.047285, 0.045819, 0.046342, 0.052404, 0.044193, 0.049911, 0.054358, 0.045376, 0.055863, 0.047875, 0.054320, 0.060507
#*# 	0.072878, 0.078196, 0.075810, 0.086843, 0.083046, 0.079196, 0.085012, 0.078882, 0.080384, 0.074246, 0.066883, 0.069523, 0.060541, 0.055775, 0.052538, 0.045068, 0.050762, 0.043897, 0.041189, 0.038371, 0.031588, 0.037986, 0.034823, 0.030959, 0.042713, 0.034340, 0.044623, 0.040790, 0.036163, 0.047281, 0.043556, 0.044115
#*# 	0.063454, 0.069514, 0.072239, 0.074255, 0.079854, 0.069843, 0.072748, 0.074853, 0.064292, 0.070259, 0.057864, 0.056655, 0.056344, 0.042906, 0.042924, 0.038566, 0.034675, 0.037736, 0.025867, 0.027474, 0.024811, 0.023133, 0.027892, 0.020201, 0.026133, 0.032832, 0.024666, 0.035561, 0.026062, 0.032011, 0.037525, 0.029855
#*# 	0.063071, 0.061246, 0.066386, 0.065460, 0.072761, 0.069720, 0.064756, 0.068864, 0.063043, 0.063752, 0.056258, 0.048577, 0.049996, 0.041227, 0.036414, 0.031885, 0.024698, 0.029947, 0.022368, 0.020827, 0.017813, 0.011322, 0.019939, 0.016321, 0.013948, 0.023817, 0.016764, 0.026941, 0.023046, 0.019610, 0.029411, 0.026356
#*# 	0.061160, 0.062484, 0.063707, 0.069422, 0.064428, 0.067397, 0.069164, 0.060760, 0.063960, 0.055154, 0.054003, 0.052954, 0.041167, 0.040031, 0.035214, 0.030298, 0.029476, 0.020226, 0.019743, 0.016362, 0.013961, 0.014532, 0.008047, 0.011489, 0.015038, 0.010622, 0.017982, 0.014000, 0.017970, 0.022781, 0.018233, 0.022540
#*# 	0.064152, 0.063593, 0.063097, 0.069362, 0.066065, 0.070237, 0.067346, 0.062650, 0.063772, 0.059003, 0.054939, 0.050695, 0.044167, 0.043987, 0.037644, 0.033530, 0.029754, 0.023432, 0.024154, 0.017651, 0.014315, 0.014635, 0.006750, 0.012807, 0.010650, 0.007872, 0.014997, 0.010279, 0.018568, 0.016831, 0.015900, 0.023688
#*# 	0.062308, 0.064516, 0.068250, 0.065842, 0.069004, 0.071470, 0.066153, 0.068460, 0.061653, 0.061104, 0.059286, 0.049301, 0.048000, 0.046837, 0.040812, 0.039815, 0.031493, 0.029731, 0.024283, 0.020117, 0.017793, 0.010073, 0.011030, 0.012930, 0.007931, 0.013747, 0.009222, 0.012842, 0.017080, 0.013296, 0.018501, 0.020020
#*# 	0.060443, 0.065880, 0.066092, 0.066674, 0.071631, 0.067324, 0.069909, 0.066990, 0.061729, 0.062685, 0.057602, 0.052404, 0.049117, 0.043572, 0.045493, 0.039753, 0.036593, 0.032802, 0.025220, 0.024528, 0.017251, 0.010833, 0.014673, 0.008239, 0.014077, 0.011290, 0.009183, 0.015505, 0.012994, 0.013931, 0.015253, 0.014337
#*# 	0.061091, 0.065548, 0.064857, 0.068479, 0.071097, 0.068013, 0.070778, 0.064366, 0.063277, 0.063660, 0.056930, 0.053651, 0.050988, 0.047220, 0.045440, 0.039210, 0.037338, 0.033854, 0.028700, 0.026176, 0.017678, 0.014901, 0.013133, 0.010456, 0.014382, 0.010875, 0.011851, 0.014286, 0.010237, 0.014532, 0.013911, 0.015474
#*# 	0.059732, 0.061462, 0.065921, 0.067160, 0.067321, 0.069046, 0.064900, 0.064135, 0.059924, 0.056813, 0.056618, 0.052220, 0.049258, 0.045956, 0.041453, 0.040265, 0.035416, 0.032438, 0.027797, 0.022141, 0.020046, 0.013948, 0.009596, 0.012875, 0.008979, 0.011674, 0.009810, 0.007922, 0.010424, 0.008289, 0.009403, 0.010473
#*# 	0.058986, 0.061059, 0.062940, 0.064682, 0.064668, 0.066408, 0.062382, 0.060904, 0.059237, 0.055482, 0.055277, 0.051610, 0.049043, 0.046544, 0.041531, 0.038773, 0.034396, 0.031516, 0.028200, 0.022296, 0.018821, 0.014361, 0.012218, 0.011116, 0.008672, 0.009651, 0.009041, 0.007515, 0.008692, 0.007130, 0.008735, 0.010740
#*# 	0.060199, 0.061898, 0.062258, 0.065710, 0.065274, 0.063761, 0.063996, 0.059748, 0.058609, 0.056105, 0.053573, 0.051968, 0.049206, 0.046382, 0.043268, 0.038582, 0.035592, 0.031617, 0.028041, 0.024542, 0.019382, 0.016462, 0.012746, 0.010272, 0.011504, 0.008393, 0.009914, 0.008661, 0.007460, 0.009375, 0.009636, 0.010470
#*# 	0.062891, 0.064080, 0.064133, 0.065413, 0.066612, 0.066065, 0.064750, 0.063300, 0.060046, 0.059004, 0.055755, 0.053077, 0.051070, 0.048433, 0.045694, 0.042188, 0.037761, 0.034490, 0.030608, 0.026670, 0.022326, 0.018626, 0.016312, 0.014591, 0.013791, 0.012379, 0.011620, 0.012123, 0.011562, 0.012735, 0.014775, 0.014842
#*# 	0.067830, 0.068613, 0.070205, 0.071322, 0.071379, 0.071080, 0.069490, 0.067915, 0.065384, 0.063803, 0.061877, 0.058482, 0.056619, 0.053898, 0.050121, 0.047199, 0.043720, 0.041275, 0.037323, 0.033669, 0.028440, 0.024032, 0.022096, 0.020561, 0.019440, 0.019232, 0.018755, 0.018657, 0.019301, 0.020082, 0.021596, 0.022355
#*# 	0.075735, 0.076484, 0.077829, 0.079012, 0.079321, 0.079090, 0.077255, 0.075847, 0.073775, 0.072815, 0.070449, 0.067306, 0.064714, 0.061728, 0.058487, 0.055631, 0.052713, 0.050484, 0.047015, 0.043242, 0.038342, 0.033515, 0.031120, 0.030086, 0.029431, 0.028862, 0.028869, 0.028967, 0.028999, 0.029714, 0.030944, 0.032195
#*# tension = 0.2
#*# min_x = 91.2323
#*# algo = bicubic
#*# y_count = 30
#*# mesh_y_pps = 2
#*# min_y = 91.3425
#*# x_count = 32
#*# max_y = 258.658
#*# mesh_x_pps = 2
#*# max_x = 258.772
#*#
#*# [beacon model default]
#*# model_coef = 1.3435580718913651,
#*# 	1.691617982567348,
#*# 	0.734290944139933,
#*# 	0.0886644554503296,
#*# 	0.5017544580044808,
#*# 	1.346321388730396,
#*# 	-0.3135234345618364,
#*# 	-1.4852454407209434,
#*# 	0.33280560428535966,
#*# 	0.7599171350772956
#*# model_domain = 3.0245624849533133e-07,3.328076254800804e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.603790
#*# model_offset = 0.00000
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = -0.003069062886410384
#*# xz_skew = -0.003549932739771091
#*# yz_skew = -0.0007990856794996457
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 250.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 22.063
#*# pid_ki = 1.347
#*# pid_kd = 90.367
